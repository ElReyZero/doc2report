{% extends 'base.html'%}
{% block content %}

<script>
  function copyToClipboard() {
    // Get the text field
    let url = window.location.origin;

    // Copy the text inside the text field
    navigator.clipboard.writeText(url + "/reports/public/{{report.id}}");
    document.getElementById("copied-text").style.display = "block";
  }
</script>


<div class="row">
  <div class="col-md-8">

    <h3>Restrictions Found in the Document:</h3>

    <div class="accordion" id="accordionExample">
      {% for filter, values in results.items %}
      <div class="card">
        <div class="card-header" id="heading{{filter}}">
          <h5 class="mb-0">
            <button class="btn btn-link" type="button" data-toggle="collapse" data-target="#collapse{{filter}}"
              aria-expanded="true" aria-controls="collapse{{filter}}">
              {{filter}} Restrictions
            </button>
          </h5>
        </div>

        <div id="collapse{{filter}}" class="collapse show" aria-labelledby="heading{{filter}}">
          <div class="card-body">
            {% if values %}
            <table class="table">
              <thead>
                <tr>
                  <th scope="col">Sentence</th>
                  <th scope="col">Prediction</th>
                  <th scope="col">Page</th>
                </tr>
              </thead>
              <tbody>
                {% for value in values %}
                <tr>
                  <td>{{value.cleaned_sentence}}</td>
                  <td>{{value.predicted}}</td>
                  <td>{{value.page}}</td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
            {% else %}
            <p>No {{filter}} restrictions found.</p>
            {% endif %}
          </div>
        </div>
      </div>
      {% endfor %}
    </div>
  </div>
  <div class="col-md-4">
    <h3>Document details</h3>
    <div class="text" style="white-space: pre-line">Report Name: {{report.name}}
      Document name: {{report.document.name}}
      Number of pages: {{report.document.doc_page_length}}
      <button type="text" class="btn btn-primary" value="" onClick="window.open('{{report.document.docfile.url}}', '_blank')" data-toggle="tooltip"
      data-placement="bottom" title="View Document" id="view-doc-btn" style="margin-top: 5px">View Document</button>
    </div>
    {% if report.is_public %}
    <br>
    <h3>Share this report!</h3>
    <p style="display: none;" id="copied-text">Link copied to clipboard!</p>
    <button type="text" class="btn btn-primary" value="" onClick="copyToClipboard()" data-toggle="tooltip"
      data-placement="bottom" title="Copy share link to clipboard">Copy Link
    </button>
      {% if user.id == report.user.id %}
      <br>
      <form action="{% url 'change_report_visibility' report.id %}" type="submit">
        {% csrf_token %}
        <button type="submit" class="btn btn-danger" value="" style="margin-top: 5px;">
          Make Private
        </button>
      </form>
      {% endif %}
      {% else %}
      <form action="{% url 'change_report_visibility' report.id %}" type="submit">
        {% csrf_token %}
        <button type="submit" class="btn btn-primary" value="" style="margin-top: 5px;">Make Public</button>
      </form>
      {% endif %}
  </div>
</div>

{% endblock %}